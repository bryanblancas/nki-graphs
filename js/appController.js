define(["ojs/ojcontext","knockout","jquery","ojs/ojarraydataprovider","./equivalences/scalesEquivalences","./utils/utils","ojs/ojcolor","ojs/ojknockout","ojs/ojinputtext","ojs/ojinputnumber","ojs/ojselectsingle","oj-c/buttonset-single","oj-c/button","oj-c/popup","ojs/ojchart","ojs/ojcolorspectrum","oj-c/message-toast","./components/graphs-templates/loader","./components/draggable-categories/loader","./components/reference-areas/loader"],(function(e,t,a,r,o,s,i){function l(){this._initializeVars(),this._initializeDP(),this._initializeListeners(),this._showReleaseNews()}return l.prototype._initializeVars=function(){this.graphCategories=t.observableArray([s.getGraphCatModel()]),this.chartData=t.observableArray([]),this.maxY=t.observable(100),this.stepY=t.observable(10),this.legendPosition=t.observable("bottom"),this.chartType=t.observable("polar"),this.curIdx=t.observable(),this.curCategoryName=t.observable(),this.curColorSelected=t.observable(),this.labelPosition=t.observable("auto"),this.chartOrientation=t.observable("vertical"),this.templateApplied=t.observable(!1),this.templateAppliedName=t.observable(""),this.graphSettingsOpened=t.observable(!1),this.btnOpenGraphSettingsId="btnOpenGraphSettings",this.categoryFormOpened=t.observable(!1),this.curCategoryNameToUpdate=t.observable(),this.curCategoryValueToUpdate=t.observable(),this.curCategoryColorToUpdate=t.observable(),this.curCategoryScaleToUpdate=t.observable(),this.curCategoryIdToUpdate=t.observable(),this.curCategoryPeScaleToUpdate=t.observable(),this.curColorAuxiliar=t.observable(),this.colorInputErrorMessage=t.observable(""),this.toastMessages=t.observableArray([]),this.inputTextTranslations=s.INPUT_TEXT_TRANSLATIONS,this.editCategoryErrorMessage=t.observable(""),this.referenceAreas=t.observableArray([]),this.yReferenceObjects=t.computed((function(){const e=this.referenceAreas();return s.getReferenceObjects(e)}),this),this.currentReleaseComplete=`v${s.CURRENT_RELEASE_COMPLETE}`},l.prototype._initializeDP=function(){this.scalesDp=new r(o.SCALES_LOV,{keyAttributes:"value"}),this.scalesObject=o.SCALES_LOV.reduce(((e,t)=>({...e,[t.value]:t.label})),{}),this.chartTypeOptions=[{label:"Bar",value:"cartesian"},{label:"Polar",value:"polar"}],this.labelPositionOptions=[{label:"Ver",value:"auto"},{label:"Ocultar",value:"none"}],this.orientationOptions=[{label:"Vertical",value:"vertical"},{label:"Horizontal",value:"horizontal"}],this.legendPositionDp=new r([{value:"start",label:"Izquierda"},{value:"end",label:"Derecha"},{value:"bottom",label:"Abajo"},{value:"top",label:"Arriba"}],{keyAttributes:"value"}),this.chartDataDp=new r(this.chartData,{keyAttributes:"id"}),this.toastMessagesDP=new r(this.toastMessages,{keyAttributes:"id"})},l.prototype._initializeListeners=function(){this.handleGraph=()=>this._refreshGraph(),this.handleCatValueChanged=()=>{this.curCategoryPeScaleToUpdate(this._convertToPercentile(this.curCategoryValueToUpdate(),this.curCategoryScaleToUpdate()))},this.closeToastMessage=e=>{this._deleteToastMessage(e.detail.key)},this.handleAddCategory=()=>{this._addCategory()},this.handleRemoveCategory=(e,t)=>{this._deleteCategory(t.id)},this.handleGetCurrentGraph=()=>this._getCurrentGraph(),this.handleApplyGraph=(e,t)=>this._applyGraph(e,t),this.handleGraphSaved=e=>{this.templateApplied(!0),this.templateAppliedName(e.name)},this.handleItemDrilling=e=>{this._prepareEditCategory(e.detail.data.itemData)},this.handleEditCategory=(e,t)=>{this._prepareEditCategory(t)},this.handleSaveEditCategory=()=>{this._editCategory()},this.handleCategoriesOnSortEnd=e=>this._handleCategoriesSorting(e),this.handleColorInputTextChange=e=>{try{const e=this.curColorAuxiliar();if(e){const t=new i(e);this.curCategoryColorToUpdate(t),this.colorInputErrorMessage("")}}catch(e){this.colorInputErrorMessage("Color InvÃ¡lido"),this.curCategoryColorToUpdate("")}},this.handleColorSpectrumChange=e=>{this.curColorAuxiliar(this.curCategoryColorToUpdate().toString())}},l.prototype._getCurrentGraph=function(){return{categories:this.graphCategories().map((e=>s.getGraphCatModel(e))),graphSettings:{maxY:this.maxY(),stepY:this.stepY(),legendPosition:this.legendPosition(),chartType:this.chartType(),chartOrientation:this.chartOrientation(),labelPosition:this.labelPosition(),referenceAreas:this.referenceAreas()}}},l.prototype._applyGraph=function(e,t){this.templateApplied(!0),this.templateAppliedName(e);const{graphSettings:a,categories:r}=t;if(void 0===a||void 0===r)return;this.maxY(a.maxY),this.stepY(a.stepY),this.legendPosition(a.legendPosition),this.chartType(a.chartType),this.chartOrientation(a.chartOrientation),this.labelPosition(a.labelPosition),this.referenceAreas(a.referenceAreas??[]);const o=r.map((e=>{const t=s.getGraphCatModel();return t.name=e.name,t.value=e.value,t.scale=e.scale,t.peScale=e.peScale,t.color=e.color,t}));this.graphCategories(o),this._refreshGraph()},l.prototype._handleCategoriesSorting=function(e){const t=e.oldDraggableIndex,a=e.newDraggableIndex;if(t===a)return;const r=this.graphCategories(),o=r.splice(t,1)[0];this._deleteCategoryCardFromDOM(o.id),r.splice(a,0,o),this.graphCategories([...r]),this._refreshGraph()},l.prototype._deleteCategoryCardFromDOM=function(e){const t=a(`#${e}`);t.length>0&&t.remove()},l.prototype._convertToPercentile=function(e,t){return""!==e&&t?o.transformScaleToPercentile(e,t):null},l.prototype._addToastMessage=function(e){this.toastMessages.push({...e,id:crypto.randomUUID()})},l.prototype._deleteToastMessage=function(e){this.toastMessages.remove((t=>t.id===e))},l.prototype._deleteCategory=function(e){this.graphCategories.remove((t=>t.id===e)),this._refreshGraph()},l.prototype._refreshGraph=function(){const e=this.graphCategories().map((e=>s.getDataItemForChart(e)));this.chartData(e)},l.prototype._addCategory=function(e=void 0){if(this.graphCategories().length===s.CATEGORIES_VALIDATIONS.MAX_NUMBER_OF_CATEGORIES)return void this._addToastMessage({severity:"warning",summary:s.CATEGORIES_VALIDATIONS.ON_MAX_SUMMARY,detail:s.CATEGORIES_VALIDATIONS.ON_MAX_DETAIL,autoTimeout:s.TOAST_MESSAGES_AUTO_TIMEOUT_MS});const t=s.getGraphCatModel(e);this.graphCategories.push(t),this._prepareEditCategory(t)},l.prototype._prepareEditCategory=function(e){this.curCategoryIdToUpdate(e.id),this.curCategoryNameToUpdate(e.name),this.curCategoryValueToUpdate(e.value),this.curCategoryScaleToUpdate(e.scale),this.curCategoryPeScaleToUpdate(e.peScale);const t=e.color?new i(e.color):"";this.curCategoryColorToUpdate(t),this.curColorAuxiliar(t.toString()),this.colorInputErrorMessage(""),this.categoryFormOpened(!0)},l.prototype._editCategory=function(){const e=this.curCategoryIdToUpdate(),t=this.curCategoryNameToUpdate(),a=this.curCategoryValueToUpdate(),r=this.curCategoryScaleToUpdate(),o=this.curCategoryPeScaleToUpdate(),i=this.curCategoryColorToUpdate()?this.curCategoryColorToUpdate().toString():"";if(!t||""===a||!r)return void this.editCategoryErrorMessage(s.EDIT_CAT_ERROR_MESSAGE);this.editCategoryErrorMessage();const l=this.graphCategories().find((t=>t.id===e)),h=s.getGraphCatModel({name:t,value:a,scale:r,peScale:o,color:i,id:e});this.graphCategories.replace(l,h),this.categoryFormOpened(!1),this._refreshGraph()},l.prototype._showReleaseNews=function(){const e=s.getReleaseNews();e&&this._addToastMessage({...e})},e.getPageContext().getBusyContext().applicationBootstrapComplete(),new l}));