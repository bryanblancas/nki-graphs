define(["ojs/ojcontext","knockout","ojs/ojarraydataprovider","./equivalences/scalesEquivalences","./utils/utils","ojs/ojknockout","ojs/ojinputtext","ojs/ojinputnumber","ojs/ojselectsingle","oj-c/buttonset-single","oj-c/button","oj-c/popup","ojs/ojchart","ojs/ojcolorspectrum","./components/graphs-templates/loader"],(function(t,e,a,i,s){function o(){this._initializeVars(),this._initializeDP(),this._initializeListeners()}return o.prototype._initializeVars=function(){this.graphCategories=e.observableArray([s.getGraphCatModel()]),this.chartData=e.observableArray([]),this.maxY=e.observable(100),this.stepY=e.observable(10),this.legendPosition=e.observable("bottom"),this.chartType=e.observable("polar"),this.opened=e.observable(!1),this.curIdx=e.observable(),this.curCategoryName=e.observable(),this.curColorSelected=e.observable(),this.labelPosition=e.observable("auto"),this.chartOrientation=e.observable("vertical"),this.templateApplied=e.observable(!1),this.templateAppliedName=e.observable(""),this.graphSettingsOpened=e.observable(!1),this.btnOpenGraphSettingsId="btnOpenGraphSettings"},o.prototype._initializeDP=function(){this.scalesDp=new a(i.SCALES_LOV,{keyAttributes:"value"}),this.chartTypeOptions=[{label:"Bar",value:"cartesian"},{label:"Polar",value:"polar"}],this.labelPositionOptions=[{label:"Ver",value:"auto"},{label:"Ocultar",value:"none"}],this.orientationOptions=[{label:"Vertical",value:"vertical"},{label:"Horizontal",value:"horizontal"}],this.legendPositionDp=new a([{value:"start",label:"Izquierda"},{value:"end",label:"Derecha"},{value:"bottom",label:"Abajo"},{value:"top",label:"Arriba"}],{keyAttributes:"value"}),this.dataProvider=new a(this.graphCategories,{keyAttributes:"name"}),this.chartDataDp=new a(this.chartData,{keyAttributes:"id"})},o.prototype._initializeListeners=function(){this.handleCatValueChanged=(t,e,a)=>{const s=e.data.value(),o=e.data.scale();s&&o?e.data.peScale(i.transformScaleToPercentile(s,o)):e.data.peScale("n/a")},this.getCategoryNameInputId=(t,e="oj")=>{const a=`catName-${t}`;return"oj"===e?a:`${a}|input`},this.handleAddCategory=()=>{this.graphCategories.push(s.getGraphCatModel()),setTimeout((()=>{document.getElementById(this.getCategoryNameInputId(this.graphCategories().length-1,"native")).focus()}),200)},this.handleRemoveCategory=(t,e,a)=>{this.graphCategories.remove(e.data)},this.handleGraph=()=>{const t=this.graphCategories().map(((t,e)=>s.getDataItemForChart(t,e)));this.chartData(t)},this.handleChangeChartType=t=>{this.chartType(t)},this.openListener=(t,e,a)=>{const i=e.index;this.curIdx(i),this.curCategoryName(this.graphCategories()[i].name()),this.opened(!0)},this.cancelListener=()=>{this.opened(!1)},this.applyColor=()=>{const t=this.curIdx(),e=this.curColorSelected();this.graphCategories()[t].color(e.toString()),this.cancelListener()},this.handleGetCurrentGraph=()=>this._getCurrentGraph(),this.handleApplyGraph=(t,e)=>this._applyGraph(t,e),this.handleGraphSaved=t=>{this.templateApplied(!0),this.templateAppliedName(t.name)}},o.prototype._getCurrentGraph=function(){return{categories:this.graphCategories().map((t=>s.getGraphCatModel(t))),graphSettings:{maxY:this.maxY(),stepY:this.stepY(),legendPosition:this.legendPosition(),chartType:this.chartType(),chartOrientation:this.chartOrientation(),labelPosition:this.labelPosition()}}},o.prototype._applyGraph=function(t,e){this.templateApplied(!0),this.templateAppliedName(t);const{graphSettings:a,categories:i}=e;if(void 0===a||void 0===i)return;this.maxY(a.maxY),this.stepY(a.stepY),this.legendPosition(a.legendPosition),this.chartType(a.chartType),this.chartOrientation(a.chartOrientation),this.labelPosition(a.labelPosition);const o=i.map((t=>{const e=s.getGraphCatModel();return e.name(t.name),e.value(t.value),e.scale(t.scale),e.peScale(t.peScale),e.color(t.color),e}));this.graphCategories(o),this.handleGraph()},t.getPageContext().getBusyContext().applicationBootstrapComplete(),new o}));