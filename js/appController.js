define(["ojs/ojcontext","knockout","jquery","ojs/ojarraydataprovider","./equivalences/scalesEquivalences","./utils/utils","ojs/ojcolor","ojs/ojknockout","ojs/ojinputtext","ojs/ojinputnumber","ojs/ojselectsingle","oj-c/buttonset-single","oj-c/button","oj-c/popup","ojs/ojchart","ojs/ojcolorspectrum","./components/graphs-templates/loader","./components/draggable-categories/loader"],(function(e,t,a,o,r,i,s){function l(){this._initializeVars(),this._initializeDP(),this._initializeListeners()}return l.prototype._initializeVars=function(){this.graphCategories=t.observableArray([i.getGraphCatModel()]),this.chartData=t.observableArray([]),this.maxY=t.observable(100),this.stepY=t.observable(10),this.legendPosition=t.observable("bottom"),this.chartType=t.observable("polar"),this.curIdx=t.observable(),this.curCategoryName=t.observable(),this.curColorSelected=t.observable(),this.labelPosition=t.observable("auto"),this.chartOrientation=t.observable("vertical"),this.templateApplied=t.observable(!1),this.templateAppliedName=t.observable(""),this.graphSettingsOpened=t.observable(!1),this.btnOpenGraphSettingsId="btnOpenGraphSettings",this.categoryFormOpened=t.observable(!1),this.curCategoryNameToUpdate=t.observable(),this.curCategoryValueToUpdate=t.observable(),this.curCategoryColorToUpdate=t.observable(),this.curCategoryScaleToUpdate=t.observable(),this.curCategoryIdToUpdate=t.observable(),this.curCategoryPeScaleToUpdate=t.observable(),this.curColorAuxiliar=t.observable(),this.colorInputErrorMessage=t.observable("")},l.prototype._initializeDP=function(){this.scalesDp=new o(r.SCALES_LOV,{keyAttributes:"value"}),this.scalesObject=r.SCALES_LOV.reduce(((e,t)=>({...e,[t.value]:t.label})),{}),this.chartTypeOptions=[{label:"Bar",value:"cartesian"},{label:"Polar",value:"polar"}],this.labelPositionOptions=[{label:"Ver",value:"auto"},{label:"Ocultar",value:"none"}],this.orientationOptions=[{label:"Vertical",value:"vertical"},{label:"Horizontal",value:"horizontal"}],this.legendPositionDp=new o([{value:"start",label:"Izquierda"},{value:"end",label:"Derecha"},{value:"bottom",label:"Abajo"},{value:"top",label:"Arriba"}],{keyAttributes:"value"}),this.chartDataDp=new o(this.chartData,{keyAttributes:"id"})},l.prototype._initializeListeners=function(){this.handleCatValueChanged=(e,t,a)=>{const o=this.curCategoryValueToUpdate(),i=this.curCategoryScaleToUpdate();o&&i?this.curCategoryPeScaleToUpdate(r.transformScaleToPercentile(o,i)):this.curCategoryPeScaleToUpdate("n/a")},this.handleAddCategory=()=>{const e=i.getGraphCatModel();this.handleEditCategory({},e),this.graphCategories.push(e)},this.handleRemoveCategory=(e,t,a)=>{this.graphCategories.remove((e=>e.id===t.id)),this.handleGraph()},this.handleGraph=()=>{const e=this.graphCategories().map(((e,t)=>i.getDataItemForChart(e,t)));this.chartData(e)},this.handleChangeChartType=e=>{this.chartType(e)},this.applyColor=()=>{const e=this.curIdx(),t=this.curColorSelected();this.graphCategories()[e].color(t.toString()),this.cancelListener()},this.handleGetCurrentGraph=()=>this._getCurrentGraph(),this.handleApplyGraph=(e,t)=>this._applyGraph(e,t),this.handleGraphSaved=e=>{this.templateApplied(!0),this.templateAppliedName(e.name)},this.handleEditCategory=(e,t)=>{this.categoryFormOpened(!0),this.curCategoryNameToUpdate(t.name),this.curCategoryValueToUpdate(t.value),this.curCategoryScaleToUpdate(t.scale),this.curCategoryIdToUpdate(t.id);const a=t.color?new s(t.color):"";this.curCategoryColorToUpdate(a),this.curColorAuxiliar(a.toString()),this.colorInputErrorMessage("")},this.handleSaveEditCategory=()=>{const e=this.curCategoryIdToUpdate(),t=this.graphCategories().find((t=>t.id===e)),a=i.getGraphCatModel({name:this.curCategoryNameToUpdate(),value:this.curCategoryValueToUpdate(),scale:this.curCategoryScaleToUpdate(),peScale:this.curCategoryPeScaleToUpdate(),color:this.curCategoryColorToUpdate()?this.curCategoryColorToUpdate().toString():"",id:e});this.graphCategories.replace(t,a),this.categoryFormOpened(!1),this.handleGraph()},this.handleCategoriesOnSortEnd=e=>this._handleCategoriesSorting(e),this.handleColorInputTextChange=e=>{try{const e=this.curColorAuxiliar();if(e){const t=new s(e);this.curCategoryColorToUpdate(t),this.colorInputErrorMessage("")}}catch(e){this.colorInputErrorMessage("Color InvÃ¡lido"),this.curCategoryColorToUpdate("")}},this.handleColorSpectrumChange=e=>{this.curColorAuxiliar(this.curCategoryColorToUpdate().toString())}},l.prototype._getCurrentGraph=function(){return{categories:this.graphCategories().map((e=>i.getGraphCatModel(e))),graphSettings:{maxY:this.maxY(),stepY:this.stepY(),legendPosition:this.legendPosition(),chartType:this.chartType(),chartOrientation:this.chartOrientation(),labelPosition:this.labelPosition()}}},l.prototype._applyGraph=function(e,t){this.templateApplied(!0),this.templateAppliedName(e);const{graphSettings:a,categories:o}=t;if(void 0===a||void 0===o)return;this.maxY(a.maxY),this.stepY(a.stepY),this.legendPosition(a.legendPosition),this.chartType(a.chartType),this.chartOrientation(a.chartOrientation),this.labelPosition(a.labelPosition);const r=o.map((e=>{const t=i.getGraphCatModel();return t.name=e.name,t.value=e.value,t.scale=e.scale,t.peScale=e.peScale,t.color=e.color,t}));this.graphCategories(r),this.handleGraph()},l.prototype._handleCategoriesSorting=function(e){const t=e.oldDraggableIndex,a=e.newDraggableIndex;if(t===a)return;const o=this.graphCategories(),r=o.splice(t,1)[0];this._deleteCategoryCardFromDOM(r.id),o.splice(a,0,r),this.graphCategories([...o]),this.handleGraph()},l.prototype._deleteCategoryCardFromDOM=function(e){const t=a(`#${e}`);t.length>0&&t.remove()},e.getPageContext().getBusyContext().applicationBootstrapComplete(),new l}));