define(["ojs/ojcontext","knockout","jquery","./graph-templates-utils","../../utils/utils","ojs/ojarraydataprovider","oj-c/popup","ojs/ojinputtext","ojs/ojselectsingle"],(function(t,e,r,s,a,i){function l(t){this.properties=t.properties,this._initState(),this._defineAuxiliars(),this._defineHandlers()}return l.prototype._initState=function(){this.saveTmplBtnId="saveChartTmplBtn",this.saveTmplModalId="saveChartTmplModal",this.applyTmplBtnId="applyChartTmplBtn",this.applyTmplModalId="applyChartTmplModal",this.saveTmplOpened=e.observable(!1),this.applyTmplOpened=e.observable(!1),this.chartTmplName=e.observable(""),this.chartTmplDesc=e.observable(""),this.showError=e.observable(!1),this.errorMessage=e.observable(""),this.selectedChart=e.observable(null),this.selectedChartObj=e.observable(null),this.templates=e.observableArray([]),this.templatesDP=new i(this.templates,{keyAttributes:"name"}),this.inputTextTranslations=a.INPUT_TEXT_TRANSLATIONS},l.prototype._defineAuxiliars=function(){this._preventDefault=t=>t.detail?.originalEvent?.preventDefault(),this._getChartTemplFromName=t=>{const e=this.templates().findIndex((e=>e.name===t));if(e>-1){const t=this.templates()[e];return t.index=e,t}return null}},l.prototype._defineHandlers=function(){this.handleApplyChartTmpl=t=>{this._preventDefault(t),console.log("handleApplyChartTmpl")},this.handleSaveChartTmplClick=t=>{this._preventDefault(t),this._saveChartTmpl()},this.handleOpenApplyTmplModal=t=>{this._preventDefault(t),this._bindTemplates(),this.applyTmplOpened(!0)},this.handleSelectedChartChange=()=>{this._setState({showError:!1,errorMessage:""});const t=this.selectedChart();this.selectedChartObj(this._getChartTemplFromName(t))},this.handleApplyChartTmplClick=t=>{this._preventDefault(t),this._applyChartTempl()},this.handleRemoveChartTmplClick=t=>{this._preventDefault(t),this._removeChartTmpl()}},l.prototype._saveChartTmpl=function(){this._setState({showError:!1});const t=this.chartTmplName(),e=this.chartTmplDesc();if(!this._canSaveCurrentChartTmpl(t,e))return void this._setState({showError:!0,errorMessage:"Por favor, completa el formulario"});const r={name:t,description:e,chartData:this.properties.getCurrentChart()},a=s.saveChartTemplate(r);!0===a?(this.saveTmplOpened(!1),this.chartTmplName(),this.chartTmplDesc(),this.properties.onChartSaved(r)):this._setState({showError:!0,errorMessage:a})},l.prototype._setState=function({showError:t,errorMessage:e}){void 0!==t&&this.showError(t),void 0!==e&&this.errorMessage(e)},l.prototype._canSaveCurrentChartTmpl=function(t,e){return!!t&&!("string"==typeof e&&e.length>100)},l.prototype._bindTemplates=function(){const t=s.getChartTemplates()||[];this.templates(t)},l.prototype._applyChartTempl=function(){const t=this.selectedChartObj();t?(this.properties.applyChartTemplate(t.name,t.chartData),this.selectedChart(null),this.selectedChartObj(null),this.applyTmplOpened(!1)):this._setState({showError:!0,errorMessage:"Selecciona un gráfico"})},l.prototype._removeChartTmpl=function(){const t=this.selectedChartObj();if(!t)return void this._setState({showError:!0,errorMessage:"Selecciona un gráfico"});const e=t.index;this.templates.remove((t=>t.index===e));!0!==s.saveChartTemplates(this.templates())&&this._setState({showError:!0,errorMessage:"Hubo un error al eliminar el gráfico."})},l}));