define(["ojs/ojcontext","knockout","jquery","./graph-templates-utils","ojs/ojarraydataprovider","oj-c/popup","ojs/ojinputtext","ojs/ojselectsingle"],(function(e,t,r,s,a){function i(e){this.properties=e.properties,this._initState(),this._defineAuxiliars(),this._defineHandlers()}return i.prototype._initState=function(){this.saveTmplBtnId="saveChartTmplBtn",this.saveTmplModalId="saveChartTmplModal",this.applyTmplBtnId="applyChartTmplBtn",this.applyTmplModalId="applyChartTmplModal",this.saveTmplOpened=t.observable(!1),this.applyTmplOpened=t.observable(!1),this.chartTmplName=t.observable(""),this.chartTmplDesc=t.observable(""),this.showError=t.observable(!1),this.errorMessage=t.observable(""),this.selectedChart=t.observable(null),this.selectedChartObj=t.observable(null),this.templates=t.observableArray([]),this.templatesDP=new a(this.templates,{keyAttributes:"name"})},i.prototype._defineAuxiliars=function(){this._preventDefault=e=>e.detail?.originalEvent?.preventDefault(),this._getChartTemplFromName=e=>{const t=this.templates().findIndex((t=>t.name===e));if(t>-1){const e=this.templates()[t];return e.index=t,e}return null}},i.prototype._defineHandlers=function(){this.handleApplyChartTmpl=e=>{this._preventDefault(e),console.log("handleApplyChartTmpl")},this.handleSaveChartTmplClick=e=>{this._preventDefault(e),this._saveChartTmpl()},this.handleOpenApplyTmplModal=e=>{this._preventDefault(e),this._bindTemplates(),this.applyTmplOpened(!0)},this.handleSelectedChartChange=()=>{this._setState({showError:!1,errorMessage:""});const e=this.selectedChart();this.selectedChartObj(this._getChartTemplFromName(e))},this.handleApplyChartTmplClick=e=>{this._preventDefault(e),this._applyChartTempl()},this.handleRemoveChartTmplClick=e=>{this._preventDefault(e),this._removeChartTmpl()}},i.prototype._saveChartTmpl=function(){this._setState({showError:!1});const e=this.chartTmplName(),t=this.chartTmplDesc();if(!this._canSaveCurrentChartTmpl(e,t))return void this._setState({showError:!0,errorMessage:"Por favor, escribe un nombre y una description de no m치s de 100 letras."});const r={name:e,description:t,chartData:this.properties.getCurrentChart()},a=s.saveChartTemplate(r);!0===a?(this.saveTmplOpened(!1),this.chartTmplName(),this.chartTmplDesc(),this.properties.onChartSaved(r)):this._setState({showError:!0,errorMessage:a})},i.prototype._setState=function({showError:e,errorMessage:t}){void 0!==e&&this.showError(e),void 0!==t&&this.errorMessage(t)},i.prototype._canSaveCurrentChartTmpl=function(e,t){return!!e&&!("string"==typeof t&&t.length>100)},i.prototype._bindTemplates=function(){const e=s.getChartTemplates()||[];this.templates(e)},i.prototype._applyChartTempl=function(){const e=this.selectedChartObj();e?(this.properties.applyChartTemplate(e.name,e.chartData),this.selectedChart(null),this.selectedChartObj(null),this.applyTmplOpened(!1)):this._setState({showError:!0,errorMessage:"Selecciona un gr치fico"})},i.prototype._removeChartTmpl=function(){const e=this.selectedChartObj();if(!e)return void this._setState({showError:!0,errorMessage:"Selecciona un gr치fico"});const t=e.index;this.templates.remove((e=>e.index===t));!0!==s.saveChartTemplates(this.templates())&&this._setState({showError:!0,errorMessage:"Hubo un error al eliminar el gr치fico."})},i}));