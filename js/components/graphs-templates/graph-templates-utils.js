define(["../../utils/utils","downloadjs"],(function(t,e){const r="nki-graphs-templates",a={MAX_NUMBER_OF_TEMPLATES:40,ON_MAX_TEXT:"Máximo número de gráficos alcanzado (40)."},n=()=>{const t=localStorage.getItem(r);if(!t)return null;try{return JSON.parse(t)}catch(t){return console.error("Failed to parse JSON from localStorage:",t),null}},o="nkiGraphs-templatesExporting",s=async t=>{const e=JSON.stringify(t).normalize("NFC"),r=(new TextEncoder).encode(e),a=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(a)).map((t=>t.toString(16).padStart(2,"0"))).join("")};return{getChartTemplates:n,saveChartTemplate:t=>{try{const e=n()||[];if(e.length>=a.MAX_NUMBER_OF_TEMPLATES)return a.ON_MAX_TEXT;const o=e.findIndex((e=>e.name===t.name));-1!==o?e[o]=t:e.push(t);const s=JSON.stringify(e);return localStorage.setItem(r,s),!0}catch(t){return console.error("Failed to serialize or save to localStorage:",t),"Hubo un error al momento de guardar el gráfico."}},saveChartTemplates:t=>{try{const e=JSON.stringify(t);return localStorage.setItem(r,e),!0}catch(t){return console.error("Failed to serialize or save to localStorage:",t),!1}},MINI_GRAPH_PREVIEW_PROPERTIES:{getCoordinateSystem:t=>t?.chartData?.graphSettings?.chartType??"cartesian",getYMax:t=>t?.chartData?.graphSettings?.maxY,getStep:t=>t?.chartData?.graphSettings?.stepY,getOrientation:t=>t?.chartData?.graphSettings?.chartOrientation,getChartData:e=>(e?.chartData?.categories??[]).map((e=>t.getDataItemForChart(e))),getReferenceObjects:e=>{const r=e?.chartData?.graphSettings?.referenceAreas??[];return t.getReferenceObjects(r)}},exportTemplates:async()=>{const t=n();if(!t)throw new Error("No graphs to export");const r=await s(t),a={templates:t,metadata:{version:"1.0",exportDate:(new Date).toISOString(),appID:o,checksum:r},environment:{ojetVersion:"17.0.0"}},i=((t,e="application/json")=>{const r=(new TextEncoder).encode(t),a=new Uint8Array([239,187,191]),n=new Uint8Array(a.length+r.length);return n.set(a),n.set(r,a.length),new Blob([n],{type:`${e};charset=utf-8`})})(JSON.stringify(a),"application/json");e(i,"nkiGraphs-export.json","application/json")},getFileContent:async t=>{if(!t)return null;try{return await t.text()}catch(t){throw console.error("Error reading file:",t),t}},isValidFileContent:async t=>{if(!t.environment.ojetVersion)return console.error("No OJET version especified"),!1;if(!t.metadata.version||!t.metadata.exportDate||t.metadata.appID!==o)return console.error("Invalid Metadata"),!1;const e=t.templates;return await s(e)===t.metadata.checksum||(console.error("Checksums do not match"),!1)},generateFileSummary:t=>({numberOfGraphs:t.templates?.length??0,date:new Date(t.metadata.exportDate).toLocaleDateString()})}}));