define(["ojs/ojcontext","knockout","jquery","./reference-areas-utils","ojs/ojcolor","oj-c/input-text","oj-c/popup","oj-c/input-number","ojs/ojswitch","ojs/ojcolorspectrum"],(function(e,r,a,s,t){function o(e){this.properties=e.properties,this._initState(),this._defineHandlers()}return o.prototype._initState=function(){this.mappedAreas=r.observableArray(s.mapAreasToObservables(this.properties.areas??[])),this.displayInLegend=r.observable(!!this.mappedAreas()[0]&&this.mappedAreas()[0].displayInLegend),this.globalErrm=r.observable(""),this.colorPickerOpened=r.observable(!1),this._currentArea=r.observable(null),this.areaColor=r.observable()},o.prototype._defineHandlers=function(){this.handleValueChanged=()=>{this._processAreasChange()},this.addArea=()=>{this.mappedAreas().length>=s.REF_AREAS_VALIDATION.max?this.globalErrm(s.REF_AREAS_VALIDATION.maxErrm):(this.globalErrm(""),this._addArea())},this.removeArea=e=>{this._removeArea(e.observableIndex())},this.handleDisplayInLegendChange=()=>{this._toggleLegendForAreas(this.displayInLegend()?"on":"off")},this.openColorPicker=e=>{let r;this._currentArea(e);try{r=new t(e.data?.color())}catch(e){r=new t("rgb(0,0,0)")}this.areaColor(r),this.colorPickerOpened(!0)},this.handleAreaColorChange=()=>{this._applyColorToArea(this._currentArea().data,this.areaColor())}},o.prototype._processAreasChange=function(){const e=s.mapObservablesToAreas(this.mappedAreas());this.properties.areas=e},o.prototype._addArea=function(){this.mappedAreas.push(s.getAreaObject({name:`Area ${this.mappedAreas().length+1}`,displayInLegend:this.displayInLegend()?"on":"off"})),this._processAreasChange()},o.prototype._removeArea=function(e){this.mappedAreas.splice(e,1),this._processAreasChange()},o.prototype._toggleLegendForAreas=function(e){this.mappedAreas(this.mappedAreas().map((r=>({...r,displayInLegend:e})))),this._processAreasChange()},o.prototype._applyColorToArea=function(e,r){e.color(r.toString())},o.prototype.propertyChanged=function(e){"areas"===e.property&&"external"===e.updatedFrom&&this.mappedAreas(s.mapAreasToObservables(e.value))},o}));