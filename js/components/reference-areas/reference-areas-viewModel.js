define(["ojs/ojcontext","knockout","jquery","./reference-areas-utils","oj-c/input-text","oj-c/input-number","ojs/ojswitch"],(function(e,s,a,r){function t(e){this.properties=e.properties,this._initState(),this._defineHandlers()}return t.prototype._initState=function(){this.mappedAreas=s.observableArray(r.mapAreasToObservables(this.properties.areas??[])),this.displayInLegend=s.observable(!!this.mappedAreas()[0]&&this.mappedAreas()[0].displayInLegend),this.globalErrm=s.observable("")},t.prototype._defineHandlers=function(){this.handleValueChanged=()=>{this._processAreasChange()},this.addArea=()=>{this.mappedAreas().length>=r.REF_AREAS_VALIDATION.max?this.globalErrm(r.REF_AREAS_VALIDATION.maxErrm):(this.globalErrm(""),this._addArea())},this.removeArea=e=>{this._removeArea(e.observableIndex())},this.handleDisplayInLegendChange=()=>{this._toggleLegendForAreas(this.displayInLegend()?"on":"off")}},t.prototype._processAreasChange=function(){const e=r.mapObservablesToAreas(this.mappedAreas());this.properties.areas=e},t.prototype._addArea=function(){this.mappedAreas.push(r.getAreaObject({name:`Area ${this.mappedAreas().length+1}`,displayInLegend:this.displayInLegend()?"on":"off"})),this._processAreasChange()},t.prototype._removeArea=function(e){this.mappedAreas.splice(e,1),this._processAreasChange()},t.prototype._toggleLegendForAreas=function(e){this.mappedAreas(this.mappedAreas().map((s=>({...s,displayInLegend:e})))),this._processAreasChange()},t.prototype.propertyChanged=function(e){"areas"===e.property&&"external"===e.updatedFrom&&this.mappedAreas(r.mapAreasToObservables(e.value))},t}));