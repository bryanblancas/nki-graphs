<!DOCTYPE html>
<!-- By: Bryan Blancas -->
<html lang="en-us">
  <head>
    <title>NKI Graphs</title>

    <meta charset="UTF-8" />
    <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1" />
    <link rel="icon" href="css/images/nkiLogo.png" type="image/x-icon" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <!-- This is the main css file for the default theme -->
<!-- injector:theme -->
<link rel="stylesheet" href="css/redwood/17.0.3/web/redwood.min.css" id="basestyles" />
<link rel="stylesheet" href="css/theme-redwood/17.0.3/web/theme.css" id="themestyle" />
<!-- endinjector -->
    <!-- This contains icon fonts used by the starter template -->
<!-- injector:font -->
<link rel="stylesheet" id="uxiconFont" href="https://static.oracle.com/cdn/fnd/gallery/2404.0.0/images/iconfont/ojuxIconFont.min.css" />
<!-- endinjector:font -->

    <!-- This is where you would add any app specific styling -->
    <link rel="stylesheet" href="css/app.css" type="text/css" />
  </head>
  <body class="oj-web-applayout-body nki-graphs-main">
    <div id="globalBody" class="oj-web-applayout-page app-container">
      <header role="banner" class="oj-web-applayout-header">
        <div class="oj-web-applayout-max-width oj-flex-bar oj-sm-align-items-center">
          <div class="oj-flex-bar-middle oj-sm-align-items-baseline">
            <img
              src="css/images/nkiLogoPage.svg"
              alt="NKI LOGO"
              width="50"
              height="50"
              class="oj-sm-padding-2x-top"
            />
            <p class="oj-sm-padding-2x-end application-name-emphasis" title="Application Name">
              NKI
            </p>
            <p class="application-name">Graphs</p>
          </div>
          <div class="oj-flex-bar-end">
            <div class="oj-flex hidden-easter-egg">BryCa ❤️</div>
          </div>
        </div>
      </header>
      <div role="main" class="oj-web-applayout-max-width oj-web-applayout-content">
        <!-- Graph Settings modal -->
        <div>
          <oj-c-popup
            opened="[[graphSettingsOpened]]"
            launcher="[[ `#${btnOpenGraphSettingsId}`]]"
            placement="end"
            auto-dismiss="focusLoss"
            modality="modeless"
            tail="simple"
            on-oj-close="[[ () => graphSettingsOpened(false) ]]"
          >
            <div class="oj-flex">
              <div class="oj-flex-item oj-sm-12 oj-sm-padding-4x oj-border rounded-borders">
                <div class="oj-flex-item">
                  <p class="section-title">Ajustes del Gráfico</p>
                  <hr />
                </div>
                <div class="oj-flex-item oj-sm-padding-1x-vertical">
                  <oj-input-number
                    id="maxy"
                    value="{{maxY}}"
                    label-hint="Valor Máximo"
                  ></oj-input-number>
                </div>
                <div class="oj-flex-item oj-sm-padding-1x-vertical">
                  <oj-input-number
                    id="stepy"
                    value="{{stepY}}"
                    label-hint="Salto Mínimo"
                  ></oj-input-number>
                </div>
                <div class="oj-flex-item oj-sm-padding-1x-vertical">
                  <oj-select-single
                    id="legendPositionSelect"
                    data="[[legendPositionDp]]"
                    value="{{legendPosition}}"
                    label-hint="Leyendas"
                  ></oj-select-single>
                </div>
                <div class="oj-flex-item oj-sm-padding-1x-vertical">
                  <span class="custom-label">Tipo de Gráfico</span>
                  <oj-c-buttonset-single
                    id="chartTypeBtn"
                    display="label"
                    items="[[chartTypeOptions]]"
                    value="{{chartType}}"
                    layout-width="equal"
                    aria-label="Tipo de Gráfico"
                  >
                  </oj-c-buttonset-single>
                </div>
                <div class="oj-flex-item oj-sm-padding-1x-vertical">
                  <span class="custom-label">Etiquetas</span>
                  <oj-c-buttonset-single
                    id="labelPositionBtn"
                    display="label"
                    items="[[labelPositionOptions]]"
                    value="{{labelPosition}}"
                    layout-width="equal"
                    aria-label="Data Labels"
                    disabled="[[chartType() === 'cartesian' ? false : true]]"
                  >
                  </oj-c-buttonset-single>
                </div>
                <div class="oj-flex-item oj-sm-padding-1x-vertical">
                  <span class="custom-label">Orientación</span>
                  <oj-c-buttonset-single
                    id="labelPositionBtn"
                    display="label"
                    items="[[orientationOptions]]"
                    value="{{chartOrientation}}"
                    layout-width="equal"
                    aria-label="Chart Orientation"
                    disabled="[[chartType() === 'cartesian' ? false : true]]"
                  >
                  </oj-c-buttonset-single>
                </div>
              </div>
            </div>
          </oj-c-popup>
        </div>
        <!-- Category form modal -->
        <div>
          <oj-c-popup
            opened="[[categoryFormOpened]]"
            auto-dismiss="focusLoss"
            modality="modal"
            anchor="window"
            tail="none"
            on-oj-close="[[ () => categoryFormOpened(false) ]]"
          >
            <div class="nkiEditCat-dialog nkiEditCat-wide-dialog">
              <div class="nkiEditCat-header">
                <h4>Editar categoría</h4>
                <oj-button
                  class="oj-button-sm oj-sm-margin-2x-vertical"
                  chroming="borderless"
                  display="icons"
                  on-oj-action="[[() => categoryFormOpened(false)]]"
                >
                  <span class="material-icons"> close </span>
                </oj-button>
              </div>
              <div class="nkiEditCat-body">
                <div class="nkiEditCat-container">
                  <div class="nkiEditCat-column nkiEditCat-column-left">
                    <oj-color-spectrum
                      label-hint="Selecciona un Color"
                      label-edge="none"
                      value="{{curCategoryColorToUpdate}}"
                      on-value-changed="[[handleColorSpectrumChange]]"
                    ></oj-color-spectrum>
                  </div>
                  <div class="nkiEditCat-column nkiEditCat-column-right">
                    <div class="oj-flex oj-sm-12 oj-sm-margin-4x-vertical">
                      <oj-input-text
                        value="{{curCategoryNameToUpdate}}"
                        label-hint="Categoría"
                        label-edge="inside"
                        required="true"
                        length.max="50"
                      >
                      </oj-input-text>
                    </div>
                    <div class="oj-flex oj-sm-12 oj-sm-margin-4x-vertical">
                      <oj-input-text
                        value="{{curColorAuxiliar}}"
                        label-hint="Color"
                        label-edge="inside"
                        on-value-changed="[[handleColorInputTextChange]]"
                      >
                      </oj-input-text>
                      <span class="nkiGraphs-warn-text">
                        <oj-bind-text value="[[colorInputErrorMessage]]"></oj-bind-text>
                      </span>
                    </div>
                    <div class="oj-flex oj-sm-12 oj-sm-margin-4x-vertical">
                      <div class="oj-flex-item oj-sm-4 oj-sm-padding-2x-end">
                        <oj-input-number
                          value="{{curCategoryValueToUpdate}}"
                          on-value-changed="[[handleCatValueChanged]]"
                          label-hint="Valor"
                          required="true"
                        ></oj-input-number>
                      </div>
                      <div class="oj-flex-item oj-sm-8 oj-sm-padding-2x-start">
                        <oj-select-single
                          data="[[scalesDp]]"
                          value="{{curCategoryScaleToUpdate}}"
                          on-value-changed="[[handleCatValueChanged]]"
                          label-hint="Escala"
                          required="true"
                        ></oj-select-single>
                      </div>
                    </div>
                    <div class="oj-flex oj-sm-justify-content-flex-end">
                      Equivalencia Percentil:
                      <oj-bind-text value="[[curCategoryPeScaleToUpdate]]"></oj-bind-text>
                    </div>
                  </div>
                </div>
              </div>
              <div class="nkiEditCat-footer">
                <div class="nkiEditCat-footer-left"></div>
                <div class="nkiEditCat-footer-right">
                  <oj-button
                    chroming="solid"
                    class="nkiGraphs-main-btn"
                    on-oj-action="[[handleSaveEditCategory]]"
                  >
                    <span slot="startIcon" class="nkiGraphs-white-text oj-sm-padding-2x-top"
                      ><span class="material-icons"> save </span></span
                    >
                    <div class="nkiGraphs-white-text">Guardar</div></oj-button
                  >
                </div>
              </div>
            </div>
          </oj-c-popup>
        </div>
        <!-- Graph data form -->
        <div class="nkiGraphs-chart-data-container">
          <!-- Section title -->
          <div class="oj-flex oj-sm-justify-content-flex-between nkiGraphs-chart-data-controls">
            <div class="oj-flex-item">
              <div class="oj-flex">
                <p class="section-title">
                  <oj-bind-if test="[[templateApplied()]]">
                    <oj-bind-text value="[[templateAppliedName]]"></oj-bind-text>
                  </oj-bind-if>
                  <oj-bind-if test="[[!templateApplied()]]"> [Gráfico sin nombre] </oj-bind-if>
                </p>
                <graph-templates
                  get-current-chart="[[handleGetCurrentGraph]]"
                  apply-chart-template="[[handleApplyGraph]]"
                  on-chart-saved="[[handleGraphSaved]]"
                >
                  <div slot="select" class="nkiGraphs-clickable-icon-cont">
                    <span class="material-icons nkiGraphs-clickable-icon"> install_desktop </span>
                  </div>
                  <div slot="save" class="nkiGraphs-clickable-icon-cont">
                    <span class="material-icons nkiGraphs-clickable-icon"> save </span>
                  </div>
                </graph-templates>
              </div>
            </div>
            <div class="oj-flex-item">
              <div class="oj-flex oj-sm-justify-content-flex-end oj-sm-12">
                <oj-button
                  id="addCategory"
                  class="oj-sm-padding-4x-horizontal"
                  chroming="solid"
                  on-oj-action="[[handleAddCategory]]"
                >
                  <span slot="startIcon" class="oj-sm-padding-2x-top"
                    ><span class="material-icons"> add </span></span
                  >
                  Agregar Categoría</oj-button
                >
                <oj-button
                  id="graph"
                  chroming="solid"
                  class="nkiGraphs-main-btn"
                  on-oj-action="[[handleGraph]]"
                >
                  <span slot="startIcon" class="nkiGraphs-white-text oj-sm-padding-2x-top"
                    ><span class="material-icons"> query_stats </span></span
                  >
                  <div class="nkiGraphs-white-text">Graficar</div></oj-button
                >
              </div>
            </div>
          </div>
          <!-- Categories -->
          <draggable-categories
            data="[[graphCategories]]"
            on-sort-end="[[handleCategoriesOnSortEnd]]"
          >
            <template slot="item" data-oj-as="currentCategory">
              <div class="nkiCard-container" :id="[[currentCategory.id]]">
                <!-- Vertical color line on the right side -->
                <div
                  class="nkiCard-color-line"
                  :style.background-color="[[currentCategory.color]]"
                ></div>
                <!-- Header with Category -->
                <div class="nkiCard-header">
                  <h3 class="nkiCard-category">
                    <oj-bind-text value="[[ currentCategory.name ]]"></oj-bind-text>
                  </h3>
                </div>
                <!-- Main Value -->
                <div class="nkiCard-value">
                  <oj-bind-text value="[[ currentCategory.value ?? '--' ]]"></oj-bind-text>
                </div>
                <!-- Scale Text -->
                <div class="nkiCard-scale">
                  <oj-bind-text value="[[ scalesObject[currentCategory.scale] ]]"></oj-bind-text>
                </div>
                <!-- Container for the icons, now at the bottom right -->
                <div class="nkiCard-icon-container">
                  <!-- Edit Icon -->
                  <span
                    class="material-icons nkiGraphs-clickable-icon"
                    on-click="[[handleEditCategory]]"
                  >
                    edit
                  </span>
                  <!-- Delete Icon -->
                  <span
                    class="material-icons nkiGraphs-clickable-icon nkiGraphs-warn-icon"
                    on-click="[[handleRemoveCategory]]"
                  >
                    delete_forever
                  </span>
                </div>
              </div>
            </template>
          </draggable-categories>
        </div>
        <!-- Graph settings and Graph -->
        <div class="nkiGraphs-chart-container">
          <!-- Chart title and settings -->
          <div class="title-section">
            <div class="oj-flex oj-sm-align-items-center">
              <h3>
                <oj-bind-if test="[[templateApplied()]]">
                  <oj-bind-text value="[[templateAppliedName]]"></oj-bind-text>
                </oj-bind-if>
                <oj-bind-if test="[[!templateApplied()]]"> [Gráfico sin nombre] </oj-bind-if>
              </h3>

              <div class="nkiGraphs-clickable-icon-cont" :id="[[btnOpenGraphSettingsId]]">
                <span
                  class="material-icons nkiGraphs-clickable-icon"
                  on-click="[[() => graphSettingsOpened(true)]]"
                >
                  settings
                </span>
              </div>
            </div>
          </div>
          <!-- Chart -->
          <div class="chart-section">
            <oj-chart
              id="nki-graph"
              coordinate-system="[[ chartType ]]"
              type="bar"
              stack="on"
              polar-grid-shape="circle"
              translations.label-no-data="Sin datos para mostrar"
              style-defaults.data-label-position="[[labelPosition]]"
              data="[[chartDataDp]]"
              animation-on-display="zoom"
              animation-on-data-change="slideToLeft"
              legend.position="[[legendPosition]]"
              y-axis.max="[[maxY]]"
              y-axis.step="[[stepY]]"
              hover-behavior="dim"
              orientation="[[chartOrientation]]"
              class="nki-graph-style"
            >
              <template slot="itemTemplate" data-oj-as="item">
                <oj-chart-item
                  value="[[item.data.value]]"
                  group-id="[[ [item.data.group] ]]"
                  series-id="[[item.data.group]]"
                  label="[[item.data.value]]"
                ></oj-chart-item>
              </template>
              <template slot="seriesTemplate" data-oj-as="series">
                <oj-chart-series color="[[series.items[0].data.color]]"></oj-chart-series>
              </template>
            </oj-chart>
          </div>
          <!-- NKI Legend -->
          <div class="footer-section">
            <p class="bottom-label">Hecho con NKI Graphs</p>
          </div>
        </div>
      </div>
    </div>

    <!-- This injects script tags for the main javascript files -->
<!-- injector:scripts -->
<script type='text/javascript' src='js/libs/require/require.js'></script>
<script type='text/javascript' src='js/bundle.js'></script>
<!-- endinjector -->
  </body>
</html>
